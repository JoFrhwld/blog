{
  "hash": "17e20ca75ca9cc5afc044113bdf1b2f8",
  "result": {
    "markdown": "---\ntitle: \"Getting a sense of priors for logistic regression\"\ndate: 2023-06-28\ntwitter-card:\n  image: \"index_files/figure-html/fig-prob-intercept-1.png\"\nopen-graph:\n  image: \"index_files/figure-html/fig-prob-intercept-1.png\"  \n---\n\n\nThis summer, I've been spending some time getting more familiar with [the nitty-gritty of Bayesian models](https://jofrhwld.github.io/rethinking-workthrough/), and I'm working on some modelling in Stan for logistic regression. Setting up the basic model formula in Stan for logistic regression is pretty straightforward:\n\n``` stan\nmu = intercept + slope * x;\ny ~ bernoulli_logit(mu);\n```\n\nAnd then you \"just\" need to set a prior for for the `intercept` and `slope` terms. But I hadn't thought about how my impulses for setting priors for ordinary linear models could be pathological for logistic regression!\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(ggdist)\nlibrary(gt)\nsource(here::here(\"_defaults.R\"))\n```\n:::\n\n\n## Simulating some intercepts\n\nLet's start by assuming that the `intercept` value should be about 0, which corresponds to a probability of 0.5.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nzero_intercept <- 0\n\n## inverse logit\nplogis(zero_intercept)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.5\n```\n:::\n:::\n\n\nSo, I'll normal distribution with a mean of 0, but what should its standard deviation be? My impulse from gaussian models is that I don't want to set the standard deviation too small, cause then I'd be using an overly informative prior. Let's simulate some intercepts from normal distributions with sds of 1, 3, and 5.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  sd = c(1, 3, 5)\n) |> \n  rowwise() |> \n  mutate(\n    intercepts = list(tibble(\n      intercept = rnorm(\n        1e6, \n        mean = 0, \n        sd = sd)\n    ))\n  ) |> \n  unnest(intercepts)->\n  intercept_samples\n```\n:::\n\n\nAnd we can visualize these samples from the prior like so.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nintercept_samples |> \n  ggplot(\n    aes(\n      intercept, \n      fill = factor(sd)\n    )\n  )+\n    stat_slab(normalize = \"panels\")+\n    facet_wrap(~sd)+\n    theme_no_y()+\n    theme(\n      legend.position = \"none\"\n    )\n```\n\n::: {.cell-output-display}\n![Samples from normal priors.](index_files/figure-html/fig-intercept-1.png){#fig-intercept width=80%}\n:::\n:::\n\n\n## How it looks in the probability space\n\nSo, maybe we should go with the \\~normal(0,5) prior, so as to not to be overly informative. Real quick, though, let's plot these distributions in the *probablity* space.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nintercept_samples |> \n  ggplot(\n    aes(\n      plogis(intercept), \n      fill = factor(sd)\n    )\n  )+\n    stat_slab(normalize = \"panels\")+\n    facet_wrap(~sd)+\n    theme_no_y()+\n    theme(\n      legend.position = \"none\"\n    )\n```\n\n::: {.cell-output-display}\n![Inverse logit samples from normal priors.](index_files/figure-html/fig-prob-intercept-1.png){#fig-prob-intercept width=80%}\n:::\n:::\n\n\nWait! My uninformative \\~normal(0,5) prior is suddenly looking *pretty* informative. The probability mass for the priors with larger standard deviations is ammassed closer to 0 and 1, rather than mostly toward the middle at 0.5! If we just roughly look at roughly how much probability mass each prior puts below 0.1 versus the middle 0.1, it's pretty clear.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nintercept_samples |> \n  mutate(\n    prob_intercept = plogis(intercept)\n  ) |> \n  group_by(sd) |> \n  summarise(\n    under_5 = mean(\n      prob_intercept < 0.1\n    ),\n    middling = mean(\n      prob_intercept > 0.45 &\n        prob_intercept < 0.55\n    )\n  ) |> \n  gt() |> \n    fmt_number(\n      decimals = 3, \n      columns = 2:3\n    ) |> \n    cols_label(\n      under_5=\"bottom 0.1\",\n      middling = \"middle 0.1\"\n      \n    )\n```\n\n::: {.cell-output-display}\n```{=html}\n<div id=\"mawrmmbwfb\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#mawrmmbwfb table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#mawrmmbwfb thead, #mawrmmbwfb tbody, #mawrmmbwfb tfoot, #mawrmmbwfb tr, #mawrmmbwfb td, #mawrmmbwfb th {\n  border-style: none;\n}\n\n#mawrmmbwfb p {\n  margin: 0;\n  padding: 0;\n}\n\n#mawrmmbwfb .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#mawrmmbwfb .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#mawrmmbwfb .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#mawrmmbwfb .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#mawrmmbwfb .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#mawrmmbwfb .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#mawrmmbwfb .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#mawrmmbwfb .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#mawrmmbwfb .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#mawrmmbwfb .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#mawrmmbwfb .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#mawrmmbwfb .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#mawrmmbwfb .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#mawrmmbwfb .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#mawrmmbwfb .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mawrmmbwfb .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#mawrmmbwfb .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#mawrmmbwfb .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#mawrmmbwfb .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mawrmmbwfb .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#mawrmmbwfb .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mawrmmbwfb .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#mawrmmbwfb .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mawrmmbwfb .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#mawrmmbwfb .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#mawrmmbwfb .gt_left {\n  text-align: left;\n}\n\n#mawrmmbwfb .gt_center {\n  text-align: center;\n}\n\n#mawrmmbwfb .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#mawrmmbwfb .gt_font_normal {\n  font-weight: normal;\n}\n\n#mawrmmbwfb .gt_font_bold {\n  font-weight: bold;\n}\n\n#mawrmmbwfb .gt_font_italic {\n  font-style: italic;\n}\n\n#mawrmmbwfb .gt_super {\n  font-size: 65%;\n}\n\n#mawrmmbwfb .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#mawrmmbwfb .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#mawrmmbwfb .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#mawrmmbwfb .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#mawrmmbwfb .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#mawrmmbwfb .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#mawrmmbwfb .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    \n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sd\">sd</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"bottom 0.1\">bottom 0.1</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"middle 0.1\">middle 0.1</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"sd\" class=\"gt_row gt_right\">1</td>\n<td headers=\"under_5\" class=\"gt_row gt_right\">0.014</td>\n<td headers=\"middling\" class=\"gt_row gt_right\">0.159</td></tr>\n    <tr><td headers=\"sd\" class=\"gt_row gt_right\">3</td>\n<td headers=\"under_5\" class=\"gt_row gt_right\">0.231</td>\n<td headers=\"middling\" class=\"gt_row gt_right\">0.053</td></tr>\n    <tr><td headers=\"sd\" class=\"gt_row gt_right\">5</td>\n<td headers=\"under_5\" class=\"gt_row gt_right\">0.330</td>\n<td headers=\"middling\" class=\"gt_row gt_right\">0.032</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n:::\n:::\n\n\n## The Upshot\n\nThe reason the symmetric and spread out distributions in the logit space turn into sharp bimodal distributions in the probability space is because the (inverse) logit transform is non linear. Basically every value below about -4.5 is going to get squished to 0, and basically every value above 4.5 is going to get squished to 1. If I want the probability distribution over the intercept to be roughly unimodal in the probability space, then the standard deviation in the logit space should be relatively small to avoid extreme values!\n\nIf we take 0.01 and 0.99 as about most extreme values, in the probability space, that the intercept could be, we can convert that to logit, and divide by 3 to get a good standard deviation for the prior, since almost all data falls within 3sds of the mean.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nqlogis(0.99)/3\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1.531707\n```\n:::\n:::\n\n\nThe prior I had just above, with sd=1, has a slightly narrower range in the probability space.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplogis(1*3)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.9525741\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\ntibble(\n  sd = c(1, 1.5)\n) |> \n  rowwise() |> \n  mutate(\n    intercepts = list(tibble(\n      intercept = rnorm(\n        1e6, \n        mean = 0, \n        sd = sd)\n    ))\n  ) |> \n  unnest(intercepts)->\n  new_intercept_samples\n```\n:::\n\n\nThe \\~normal(0, 1.5) prior looks almost like a uniform distribution in the probability space.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nnew_intercept_samples |> \n  ggplot(\n    aes(\n      plogis(intercept), \n      fill = factor(sd)\n    )\n  )+\n    stat_slab(normalize = \"panels\")+\n    facet_wrap(~sd)+\n    theme_no_y()+\n    theme(\n      legend.position = \"none\"\n    )\n```\n\n::: {.cell-output-display}\n![Inverse logit samples from normal priors.](index_files/figure-html/fig-prob-better-1.png){#fig-prob-better width=80%}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}