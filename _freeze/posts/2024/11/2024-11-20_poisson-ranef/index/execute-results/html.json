{
  "hash": "e58de2392e446e6b199d3f322753fa08",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Random Effects and Overdispersion\ndate: 2024-11-20\nwarning: false\nmessage: false\nfig-width: 5\nfig-asp: 0.62\n---\n\n\n\nToday in my stats class, my students saw me realize, in real-time, that you *can* include random intercepts in poisson models that you couldn't in ordinary gaussian models, *and* this might be a nicer way to deal with overdispersion than moving to a negative binomial model.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"_defaults.R\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(brms)\nlibrary(distributional)\nlibrary(ggdist)\nlibrary(palmerpenguins)\nlibrary(gt)\nlibrary(marginaleffects)\n```\n:::\n\n\n\n# Impossible ranefs\n\nLet's start off with the Palmer Penguin data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |> \n  gt_preview()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"taqmuglwjw\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#taqmuglwjw table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#taqmuglwjw thead, #taqmuglwjw tbody, #taqmuglwjw tfoot, #taqmuglwjw tr, #taqmuglwjw td, #taqmuglwjw th {\n  border-style: none;\n}\n\n#taqmuglwjw p {\n  margin: 0;\n  padding: 0;\n}\n\n#taqmuglwjw .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#taqmuglwjw .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#taqmuglwjw .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#taqmuglwjw .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#taqmuglwjw .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#taqmuglwjw .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#taqmuglwjw .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#taqmuglwjw .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#taqmuglwjw .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#taqmuglwjw .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#taqmuglwjw .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#taqmuglwjw .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#taqmuglwjw .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#taqmuglwjw .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#taqmuglwjw .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#taqmuglwjw .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#taqmuglwjw .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#taqmuglwjw .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#taqmuglwjw .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#taqmuglwjw .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#taqmuglwjw .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#taqmuglwjw .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#taqmuglwjw .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#taqmuglwjw .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#taqmuglwjw .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#taqmuglwjw .gt_left {\n  text-align: left;\n}\n\n#taqmuglwjw .gt_center {\n  text-align: center;\n}\n\n#taqmuglwjw .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#taqmuglwjw .gt_font_normal {\n  font-weight: normal;\n}\n\n#taqmuglwjw .gt_font_bold {\n  font-weight: bold;\n}\n\n#taqmuglwjw .gt_font_italic {\n  font-style: italic;\n}\n\n#taqmuglwjw .gt_super {\n  font-size: 65%;\n}\n\n#taqmuglwjw .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#taqmuglwjw .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#taqmuglwjw .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#taqmuglwjw .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#taqmuglwjw .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#taqmuglwjw .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#taqmuglwjw .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#taqmuglwjw .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#taqmuglwjw div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"species\">species</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"island\">island</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"bill_length_mm\">bill_length_mm</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"bill_depth_mm\">bill_depth_mm</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"flipper_length_mm\">flipper_length_mm</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"body_mass_g\">body_mass_g</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"sex\">sex</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"year\">year</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">1</th>\n<td headers=\"stub_1_1 species\" class=\"gt_row gt_left\">Adelie</td>\n<td headers=\"stub_1_1 island\" class=\"gt_row gt_left\">Torgersen</td>\n<td headers=\"stub_1_1 bill_length_mm\" class=\"gt_row gt_right\">39.1</td>\n<td headers=\"stub_1_1 bill_depth_mm\" class=\"gt_row gt_right\">18.7</td>\n<td headers=\"stub_1_1 flipper_length_mm\" class=\"gt_row gt_right\">181</td>\n<td headers=\"stub_1_1 body_mass_g\" class=\"gt_row gt_right\">3750</td>\n<td headers=\"stub_1_1 sex\" class=\"gt_row gt_left\">male</td>\n<td headers=\"stub_1_1 year\" class=\"gt_row gt_right\">2007</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">2</th>\n<td headers=\"stub_1_2 species\" class=\"gt_row gt_left\">Adelie</td>\n<td headers=\"stub_1_2 island\" class=\"gt_row gt_left\">Torgersen</td>\n<td headers=\"stub_1_2 bill_length_mm\" class=\"gt_row gt_right\">39.5</td>\n<td headers=\"stub_1_2 bill_depth_mm\" class=\"gt_row gt_right\">17.4</td>\n<td headers=\"stub_1_2 flipper_length_mm\" class=\"gt_row gt_right\">186</td>\n<td headers=\"stub_1_2 body_mass_g\" class=\"gt_row gt_right\">3800</td>\n<td headers=\"stub_1_2 sex\" class=\"gt_row gt_left\">female</td>\n<td headers=\"stub_1_2 year\" class=\"gt_row gt_right\">2007</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">3</th>\n<td headers=\"stub_1_3 species\" class=\"gt_row gt_left\">Adelie</td>\n<td headers=\"stub_1_3 island\" class=\"gt_row gt_left\">Torgersen</td>\n<td headers=\"stub_1_3 bill_length_mm\" class=\"gt_row gt_right\">40.3</td>\n<td headers=\"stub_1_3 bill_depth_mm\" class=\"gt_row gt_right\">18.0</td>\n<td headers=\"stub_1_3 flipper_length_mm\" class=\"gt_row gt_right\">195</td>\n<td headers=\"stub_1_3 body_mass_g\" class=\"gt_row gt_right\">3250</td>\n<td headers=\"stub_1_3 sex\" class=\"gt_row gt_left\">female</td>\n<td headers=\"stub_1_3 year\" class=\"gt_row gt_right\">2007</td></tr>\n    <tr><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">4</th>\n<td headers=\"stub_1_4 species\" class=\"gt_row gt_left\">Adelie</td>\n<td headers=\"stub_1_4 island\" class=\"gt_row gt_left\">Torgersen</td>\n<td headers=\"stub_1_4 bill_length_mm\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"stub_1_4 bill_depth_mm\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"stub_1_4 flipper_length_mm\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"stub_1_4 body_mass_g\" class=\"gt_row gt_right\">NA</td>\n<td headers=\"stub_1_4 sex\" class=\"gt_row gt_left\">NA</td>\n<td headers=\"stub_1_4 year\" class=\"gt_row gt_right\">2007</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">5</th>\n<td headers=\"stub_1_5 species\" class=\"gt_row gt_left\">Adelie</td>\n<td headers=\"stub_1_5 island\" class=\"gt_row gt_left\">Torgersen</td>\n<td headers=\"stub_1_5 bill_length_mm\" class=\"gt_row gt_right\">36.7</td>\n<td headers=\"stub_1_5 bill_depth_mm\" class=\"gt_row gt_right\">19.3</td>\n<td headers=\"stub_1_5 flipper_length_mm\" class=\"gt_row gt_right\">193</td>\n<td headers=\"stub_1_5 body_mass_g\" class=\"gt_row gt_right\">3450</td>\n<td headers=\"stub_1_5 sex\" class=\"gt_row gt_left\">female</td>\n<td headers=\"stub_1_5 year\" class=\"gt_row gt_right\">2007</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier; font-size: x-small; background-color: #E4E4E4;\">6..343</th>\n<td headers=\"stub_1_6 species\" class=\"gt_row gt_left\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 island\" class=\"gt_row gt_left\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 bill_length_mm\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 bill_depth_mm\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 flipper_length_mm\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 body_mass_g\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 sex\" class=\"gt_row gt_left\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 year\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td></tr>\n    <tr><th id=\"stub_1_7\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">344</th>\n<td headers=\"stub_1_7 species\" class=\"gt_row gt_left\">Chinstrap</td>\n<td headers=\"stub_1_7 island\" class=\"gt_row gt_left\">Dream</td>\n<td headers=\"stub_1_7 bill_length_mm\" class=\"gt_row gt_right\">50.2</td>\n<td headers=\"stub_1_7 bill_depth_mm\" class=\"gt_row gt_right\">18.7</td>\n<td headers=\"stub_1_7 flipper_length_mm\" class=\"gt_row gt_right\">198</td>\n<td headers=\"stub_1_7 body_mass_g\" class=\"gt_row gt_right\">3775</td>\n<td headers=\"stub_1_7 sex\" class=\"gt_row gt_left\">female</td>\n<td headers=\"stub_1_7 year\" class=\"gt_row gt_right\">2009</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nAs far as I know, no individual penguin is represented in the data twice. So let's add an `individual` column that's the same as the row number.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |> \n  mutate(\n    individual = row_number(),\n    .before = 1\n  )->\n  penguins\n```\n:::\n\n\n\nIf we try to fit an intercept only model for, say, bill length, and include a random intercept for individual, things are going to get wonky.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npeng_remod <- brm(\n  bill_length_mm ~ 1 + (1|individual),\n  data = penguins,\n  backend = \"cmdstanr\",\n  file = \"peng_re\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npeng_remod\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: gaussian \n  Links: mu = identity; sigma = identity \nFormula: bill_length_mm ~ 1 + (1 | individual) \n   Data: penguins (Number of observations: 342) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~individual (Number of levels: 342) \n              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsd(Intercept)     2.03      1.29     0.08     4.82 1.14       25       18\n\nRegression Coefficients:\n          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept    43.92      0.29    43.38    44.49 1.01      502     1634\n\nFurther Distributional Parameters:\n      Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsigma     4.87      0.75     2.58     5.74 1.15       22       20\n\nDraws were sampled using sample(hmc). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n\nNothing's converged, everything's divergent, what's going on here!\n\nWell, if we think about how the model is defined, and the structure of the data, it makes a bit more sense. We're telling the model to estimate $\\mu_i$ this way\n\n$$\n\\mu_i = \\beta_0 + \\gamma_i\n$$\n\nWhere $\\gamma_i$ is a random intercept by individual. $\\gamma_i$ is meant to be sampled from a normal distribution like:\n\n$$\n\\gamma_i \\sim \\mathcal{N}(0, \\sigma_{\\gamma})\n$$\n\nThen, we're saying the data is sampled from a normal distribution like this\n\n$$\ny_i \\sim \\mathcal{N}(\\mu_i, \\sigma)\n$$\n\n*The problem* is that because every row is one individual, the sampling statement for $\\gamma_i$ is basically a description of the residual error, and $\\sigma_{\\gamma}$ would wind up being equivalent to the standard deviation of the residuals. But that's also what $\\sigma$ in the sampling statement for $y_i$ is supposed to be.\n\nOne way to think about what's happened is we've created an identifiability problem, trying to account for the residual error with two different parameters. Another way to think about is that the individual level variation around the population mean that we wanted to capture with `(1|individual)` was *already* being captured by the residual error.\n\n# Poisson Models & Overdispersion\n\nI'd like to thank Andrew Heiss for having [his course materials online](https://bayesf22-notebook.classes.andrewheiss.com/bayes-rules/12-chapter.html#negative-binomial-regression-for-overdispersed-counts), as they helped inform my thinking on this. The data set below has a count of how many times people said \"like\" in interviews.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlike_df <- read_csv(\n  \"https://lin611-2024.github.io/notes/meetings/data/like.csv\"\n) |> \n  mutate(\n    dob_g = (dob-1985)/20,\n    .after = dob\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlike_df |> \n  gt_preview()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"fsftobbhju\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#fsftobbhju table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#fsftobbhju thead, #fsftobbhju tbody, #fsftobbhju tfoot, #fsftobbhju tr, #fsftobbhju td, #fsftobbhju th {\n  border-style: none;\n}\n\n#fsftobbhju p {\n  margin: 0;\n  padding: 0;\n}\n\n#fsftobbhju .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#fsftobbhju .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#fsftobbhju .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#fsftobbhju .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#fsftobbhju .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#fsftobbhju .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#fsftobbhju .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#fsftobbhju .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#fsftobbhju .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#fsftobbhju .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#fsftobbhju .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#fsftobbhju .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#fsftobbhju .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#fsftobbhju .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#fsftobbhju .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsftobbhju .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#fsftobbhju .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#fsftobbhju .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#fsftobbhju .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsftobbhju .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#fsftobbhju .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsftobbhju .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#fsftobbhju .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsftobbhju .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#fsftobbhju .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#fsftobbhju .gt_left {\n  text-align: left;\n}\n\n#fsftobbhju .gt_center {\n  text-align: center;\n}\n\n#fsftobbhju .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#fsftobbhju .gt_font_normal {\n  font-weight: normal;\n}\n\n#fsftobbhju .gt_font_bold {\n  font-weight: bold;\n}\n\n#fsftobbhju .gt_font_italic {\n  font-style: italic;\n}\n\n#fsftobbhju .gt_super {\n  font-size: 65%;\n}\n\n#fsftobbhju .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#fsftobbhju .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#fsftobbhju .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#fsftobbhju .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#fsftobbhju .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#fsftobbhju .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#fsftobbhju .gt_indent_5 {\n  text-indent: 25px;\n}\n\n#fsftobbhju .katex-display {\n  display: inline-flex !important;\n  margin-bottom: 0.75em !important;\n}\n\n#fsftobbhju div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {\n  height: 0px !important;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"\"></th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"id\">id</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_left\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"filler\">filler</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"n\">n</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dob\">dob</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"dob_g\">dob_g</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_right\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"total_words\">total_words</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><th id=\"stub_1_1\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">1</th>\n<td headers=\"stub_1_1 id\" class=\"gt_row gt_left\">s_001</td>\n<td headers=\"stub_1_1 filler\" class=\"gt_row gt_left\">LIKE</td>\n<td headers=\"stub_1_1 n\" class=\"gt_row gt_right\">79</td>\n<td headers=\"stub_1_1 dob\" class=\"gt_row gt_right\">1953</td>\n<td headers=\"stub_1_1 dob_g\" class=\"gt_row gt_right\">-1.60</td>\n<td headers=\"stub_1_1 total_words\" class=\"gt_row gt_right\">3524</td></tr>\n    <tr><th id=\"stub_1_2\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">2</th>\n<td headers=\"stub_1_2 id\" class=\"gt_row gt_left\">s_002</td>\n<td headers=\"stub_1_2 filler\" class=\"gt_row gt_left\">LIKE</td>\n<td headers=\"stub_1_2 n\" class=\"gt_row gt_right\">457</td>\n<td headers=\"stub_1_2 dob\" class=\"gt_row gt_right\">1990</td>\n<td headers=\"stub_1_2 dob_g\" class=\"gt_row gt_right\">0.25</td>\n<td headers=\"stub_1_2 total_words\" class=\"gt_row gt_right\">4842</td></tr>\n    <tr><th id=\"stub_1_3\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">3</th>\n<td headers=\"stub_1_3 id\" class=\"gt_row gt_left\">s_003</td>\n<td headers=\"stub_1_3 filler\" class=\"gt_row gt_left\">LIKE</td>\n<td headers=\"stub_1_3 n\" class=\"gt_row gt_right\">14</td>\n<td headers=\"stub_1_3 dob\" class=\"gt_row gt_right\">1914</td>\n<td headers=\"stub_1_3 dob_g\" class=\"gt_row gt_right\">-3.55</td>\n<td headers=\"stub_1_3 total_words\" class=\"gt_row gt_right\">2148</td></tr>\n    <tr><th id=\"stub_1_4\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">4</th>\n<td headers=\"stub_1_4 id\" class=\"gt_row gt_left\">s_004</td>\n<td headers=\"stub_1_4 filler\" class=\"gt_row gt_left\">LIKE</td>\n<td headers=\"stub_1_4 n\" class=\"gt_row gt_right\">17</td>\n<td headers=\"stub_1_4 dob\" class=\"gt_row gt_right\">1937</td>\n<td headers=\"stub_1_4 dob_g\" class=\"gt_row gt_right\">-2.40</td>\n<td headers=\"stub_1_4 total_words\" class=\"gt_row gt_right\">1799</td></tr>\n    <tr><th id=\"stub_1_5\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">5</th>\n<td headers=\"stub_1_5 id\" class=\"gt_row gt_left\">s_005</td>\n<td headers=\"stub_1_5 filler\" class=\"gt_row gt_left\">LIKE</td>\n<td headers=\"stub_1_5 n\" class=\"gt_row gt_right\">11</td>\n<td headers=\"stub_1_5 dob\" class=\"gt_row gt_right\">1904</td>\n<td headers=\"stub_1_5 dob_g\" class=\"gt_row gt_right\">-4.05</td>\n<td headers=\"stub_1_5 total_words\" class=\"gt_row gt_right\">2457</td></tr>\n    <tr><th id=\"stub_1_6\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier; font-size: x-small; background-color: #E4E4E4;\">6..352</th>\n<td headers=\"stub_1_6 id\" class=\"gt_row gt_left\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 filler\" class=\"gt_row gt_left\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 n\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 dob\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 dob_g\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td>\n<td headers=\"stub_1_6 total_words\" class=\"gt_row gt_right\" style=\"background-color: #E4E4E4;\"></td></tr>\n    <tr><th id=\"stub_1_7\" scope=\"row\" class=\"gt_row gt_right gt_stub\" style=\"font-family: Courier;\">353</th>\n<td headers=\"stub_1_7 id\" class=\"gt_row gt_left\">s_353</td>\n<td headers=\"stub_1_7 filler\" class=\"gt_row gt_left\">LIKE</td>\n<td headers=\"stub_1_7 n\" class=\"gt_row gt_right\">20</td>\n<td headers=\"stub_1_7 dob\" class=\"gt_row gt_right\">1963</td>\n<td headers=\"stub_1_7 dob_g\" class=\"gt_row gt_right\">-1.10</td>\n<td headers=\"stub_1_7 total_words\" class=\"gt_row gt_right\">2295</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\n\nI'll first try fitting this with a standard poisson model.\n\n$$\n\\log(\\lambda_i) = \\beta_0 + \\beta_1\\text{dob} + \\log(\\text{total.words)}\n$$\n\n$$\ny_i \\sim \\text{Pois}(\\lambda_i)\n$$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlike_pois <- brm(\n  n ~ dob_g + offset(log(total_words)),\n  family = poisson(),\n  data = like_df,\n  backend = \"cmdstanr\",\n  file = \"like_pois\"\n)\n```\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nplot_predictions(\n  like_pois,\n  newdata = datagrid(\n    dob_g = \\(x) seq(min(x), max(x), length = 100),\n    total_words = 1000\n  ),\n  by = \"dob_g\"\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\nIf we look at the posterior predictive check, we can see that we've got some overdispersion.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npp_check(like_pois)+\n  scale_x_log10()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\nThe poisson distribution is assuming a narrower range of \"like\" counts than the data has.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"Plot code\"}\npredictions(\n  like_pois, \n  newdata = datagrid(\n    dob_g = \\(x) seq(min(x), max(x), length = 100),\n    total_words = 1000\n  )\n) |> \n  as_tibble() |> \n  mutate(\n    like_dist = dist_poisson(estimate)\n  ) ->\n  pois_pred\n\npois_pred |> \n  ggplot(\n    aes(\n      dob_g\n    )\n  )+\n  stat_lineribbon(\n    aes(\n      ydist = like_dist\n    )\n  )+\n  geom_point(\n    data = like_df,\n    aes(\n      y = (n/total_words)*1000\n    ),\n    color = \"grey\",\n    alpha = 0.6\n  )+\n  labs(\n    y = \"likes per 1000\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\nIt's too bad we can't add a random effect by speaker, but just like the penguins, we've only got one row per individual...\n\nBut wait! Look at the $y_i$ sampling statement again!\n\n$$\ny_i \\sim \\text{Pois}(\\lambda_i)\n$$\n\nThere's no observation-level variance term in a poisson distribution. Its mean and variance are the same,\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npois_ex <- dist_poisson(1:10)\n\nmean(pois_ex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  1  2  3  4  5  6  7  8  9 10\n```\n\n\n:::\n\n```{.r .cell-code}\nvariance(pois_ex)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1]  1  2  3  4  5  6  7  8  9 10\n```\n\n\n:::\n:::\n\n\n\nSo, adding a row-level random variable wouldn't introduce the same non-identifiability issue.\n\n$$\n\\log(\\lambda_i) = \\beta_0 + \\beta_i\\text{dob} + \\gamma_i\n$$\n\n$$\n\\gamma_i\\sim\\mathcal{N}(0, \\sigma)\n$$\n\n$$\ny_i \\sim \\text{Pois}(\\lambda_i)\n$$\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlike_repois <- brm(\n  n ~ dob_g + (1|id) + offset(log(total_words)),\n  family = poisson(),\n  data = like_df,\n  backend = \"cmdstanr\",\n  file = \"like_repois\"\n)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlike_repois\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n Family: poisson \n  Links: mu = log \nFormula: n ~ dob_g + (1 | id) + offset(log(total_words)) \n   Data: like_df (Number of observations: 353) \n  Draws: 4 chains, each with iter = 2000; warmup = 1000; thin = 1;\n         total post-warmup draws = 4000\n\nMultilevel Hyperparameters:\n~id (Number of levels: 353) \n              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nsd(Intercept)     0.57      0.03     0.52     0.62 1.01      538     1157\n\nRegression Coefficients:\n          Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS\nIntercept    -3.93      0.06    -4.06    -3.81 1.01      409      909\ndob_g         0.43      0.03     0.37     0.48 1.01      472     1059\n\nDraws were sampled using sample(hmc). For each parameter, Bulk_ESS\nand Tail_ESS are effective sample size measures, and Rhat is the potential\nscale reduction factor on split chains (at convergence, Rhat = 1).\n```\n\n\n:::\n:::\n\n\n\nWe are all converged, with no divergent transitions.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\" code-summary=\"plotting code\"}\nplot_predictions(\n  like_repois,\n  newdata = datagrid(\n    dob_g = \\(x) seq(min(x), max(x), length = 100),\n    total_words = 1000\n  ),\n  re_formula = NA,\n  by = \"dob_g\"\n) +\n  geom_point(\n    data = like_df,\n    aes(\n      x = dob_g,\n      y = (n/total_words)*1000\n    ),\n    alpha = 0.2,\n    color = \"#EE6677\"\n  )+\n  labs(\n    y = \"like per 1000\"\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\nAnd the posterior predictive check looks a lot better.\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npp_check(like_repois)+\n  scale_x_log10()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=70%}\n:::\n:::\n\n\n\n## Negative Binomial?\n\nThe stats notes I linked to above turned to a negative binomial model to use in a case of overdispersion like this. I'm not quite in a place to evaluate the pros and cons of the negative binomial vs this random effects approach in general. But for this case I like the random effects better because\n\n1.  It lines up with how I *think* about this data as having a population level trend, with individual divergences off of it.\n2.  It's easier for me to explain and understand than whatever the shape parameter is for the negative binomial.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}