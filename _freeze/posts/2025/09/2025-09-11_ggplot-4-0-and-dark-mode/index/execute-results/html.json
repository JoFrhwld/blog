{
  "hash": "0394f19690bbb24e0ebc3bfd116bef2f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: ggplot2 4.0 and Dark Mode\nknitr: \n  opts_chunk: \n    warning: false\n---\n\nBack in April, Quarto v1.7 introduced [the ability to display multiple outputs from a single code chunk depending on whether or not the side is in dark mode](https://quarto.org/docs/blog/posts/2025-04-28-1.7-release/#map-computational-outputs-to-themes).\nThis was really exciting for me, because even though I prefer to keep sites in dark mode for personal use, I've found that in some presentation and teaching settings, the projector and lighting conditions make dark mode illegible.\n\nTo make it work, you add `renderings: [light, dark]` to your code chunk yaml, then plot the same data twice: the first time with light mode color settings, and the second time with dark mode color settings.\nIf you toggle between light & dark mode on this post, the plot should t\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n````{.cell-code}\n```{{r}}\n#| renderings: \n#|   - light\n#|   - dark\n#| fig-width: 5\n#| fig-height: 3\nlibrary(withr)\n\nplot(1:10)\n\nwith_par(\n  list(bg = \"#222\", \n       col = \"white\", \n       fg = \"white\",\n       col.axis = \"white\",\n       col.lab = \"white\"\n       \n       ),\n  plot(1:10)\n)\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-1.png){width=480}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-1-2.png){width=480}\n:::\n:::\n\n\nWith ggplot, I've already semi-customized my default theme for when I source my [\\_defaults](/defaults.qmdl#r-defaults)[.R](/defaults.qmd) that looks like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\n\ntheme_set(\n  theme_minimal(base_size = 16) +\n    theme(\n      text = element_text(family = \"Public Sans\"),\n      panel.grid = element_blank(),\n      legend.key = element_blank(),\n      axis.ticks = element_blank(),\n      axis.line = element_line(color = \"grey60\", linewidth = 0.2),\n      legend.background = element_blank()\n    )\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |>\n  ggplot(\n    aes(bill_len, bill_dep)\n  )+\n    geom_point(\n      aes(color = species)\n    ) ->\n  plot1\n\nplot1\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-3-1.png){width=768}\n:::\n:::\n\n\nThen, I had an additional `theme_darkmode()` I'd add:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_darkmode <- function(){\n  theme(\n    text = element_text(family = \"Public Sans\", colour = \"white\"),\n    axis.text = element_text(colour = \"white\"),\n    rect = element_rect(colour = \"#222\", fill = \"#222\"),\n    plot.background = element_rect(fill = \"#222\", colour = NA),\n    panel.background = element_rect(fill = \"#424952\"),\n    strip.background = element_rect(fill=\"#3d3d3d\"),\n    strip.text = element_text(color = \"white\")\n  )\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot1 + theme_darkmode()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=768}\n:::\n:::\n\n\nThe *issue* arose in darkmode when I hadn't mapped the color aesthetic to any data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npenguins |>\n  ggplot(\n    aes(bill_len, bill_dep)\n  )+\n    geom_point() ->\n  plot2\n\nplot2 + theme_darkmode()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=768}\n:::\n:::\n\n\nThe default point colors weren't settable by a theme, and I had to use some unpleasant dark rendering functions to get things working nicely.\n\n## Redoing it with ggplot2 v4\n\nSo, I'm going to rewrite my theme settings to take account of the fact that ggplot2 now has \"ink\" and \"paper\" color settings you can define.\nI'll re-define my default theme with the new `theme_sub_*()` layers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(\n  theme_minimal(base_size = 16) +\n    theme(\n      text = element_text(family = \"Public Sans\")\n    ) +\n    theme_sub_panel(\n      grid = element_blank(),\n    ) +\n    theme_sub_legend(\n      key = element_blank(),\n      background = element_blank()\n    ) +\n    theme_sub_axis(\n      ticks = element_blank(),\n      line = element_line(color = \"grey60\", linewidth = 0.2)\n    )\n)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot2\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=768}\n:::\n:::\n\n\nAnd now I'll define my darkmode theme:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_darkmode <- function(){\n  theme_minimal(\n    base_size = 16,\n    paper = \"#222\",\n    ink = \"white\"\n  ) +\n    theme(\n      text = element_text(family = \"Public Sans\")\n    ) +\n    theme_sub_panel(\n      background = element_rect(\n        fill = \"#424952\", color = NA\n      ),\n      grid = element_blank()\n    ) +\n    theme_sub_legend(\n      key = element_blank(),\n      background = element_blank()\n    ) +\n    theme_sub_axis(\n      line = element_line(\n        color = \"grey60\", linewidth = 0.2\n      )\n    )\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplot2 +\n  theme_darkmode()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=768}\n:::\n:::\n\n\nSo now to have one code chunk with different outputs in light vs dark mode, it's just\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n````{.cell-code}\n```{{r}}\n#| renderings: \n#|   - light\n#|   - dark\nplot2\nplot2 + theme_darkmode()\n```\n````\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-1.png){width=768}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-11-2.png){width=768}\n:::\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}