{
  "hash": "bb62e43d22523a31fe9a88ca3be367c2",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Animating a Sound Wave\nimage: index_files/figure-html/unnamed-chunk-15-1.gif\n---\n\nI've been teaching phonetics for the first time in a while, and I wanted to make some animations illustrating how sounds are pressure waves in propagating through the air.\nI worked how how to do this in a fairly tidy way, again leveraging the new `stat_manual()` from `{ggplot2}`, and `{gganimate}`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsource(here::here(\"_defaults.R\"))\nlibrary(tidyverse)\nlibrary(scales)\nlibrary(gganimate)\nlibrary(geomtextpath)\nlibrary(ggdiagram)\nlibrary(scico)\n```\n:::\n\n\n## No Sound\n\nFor the baseline of my animations, I'm going to use uniformly distributed points 2 cycles wide, and 1 tall.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(2025)\ntibble(\n  x = runif(500, min = 0, max = 2),\n  y = runif(500, min = 0, max = 1)\n) ->\n  uniform\n```\n:::\n\n\n::: {.callout-note collapse=\"true\"}\n## The no_x, no_y themes\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_no_x\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nfunction (...) \n{\n    theme_sub_axis_x(text = element_blank(), title = element_blank())\n}\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_no_y\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nfunction (...) \n{\n    theme_sub_axis_y(text = element_blank(), title = element_blank(), \n        ...)\n}\n```\n\n\n:::\n:::\n\n:::\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code}\nuniform |> \n  ggplot(\n    aes(x, y)\n  ) +\n  geom_point() +\n  theme_no_x() +\n  theme_no_y()\n\nlast_plot() + theme_darkmode() + \n  theme_no_x() + \n  theme_no_y()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=576}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-2.png){width=576}\n:::\n:::\n\n\n## A static view\n\nNext, I had to work out how a \"static\" visualization of the sound wave would look.\nThe typical visualization of a sine wave, representing air pressure changes, is fairly straightforward.\nFor use as a `stat_manual()` function, I wanted to make it flexible enough for me to define a frequency for the sine wave in the `ggplot()` call.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_sine <- function(df){\n  # if there's no `freq` column\n  # set `freq` to 1.\n  if (!\"freq\" %in% names(df)) {\n    df$freq <- 1\n  }\n  \n  df |> \n    mutate(\n      y = sin(\n        (freq * x * 2 * pi)\n      )\n    )\n}\n```\n:::\n\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code}\nexpand_grid(\n  x = seq(0,2, length = 200),\n  freq = c(1,2,3)\n) |> \n  ggplot(\n    aes(\n      x, freq = freq\n    )\n  )+\n  geom_line(\n    aes(\n      y = after_stat(y)\n    ),\n    stat = \"manual\",\n    fun = make_sine\n  ) +\n  facet_wrap(\n    ~freq,\n    ncol = 1,\n    label = label_both\n  )+\n  theme_no_x() +\n  theme_no_y()\n\nlast_plot() + theme_darkmode() +\n  theme_no_x() + \n  theme_no_y()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=576}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-2.png){width=576}\n:::\n:::\n\n\nOk, next, I want to be able to displace the points representing air molecules to the left or the right depending so that they cluster together at the peaks of the sine waves, and spread apart at the troughs.\nSo if a point is at a peak or a trough, it should be relatively stationary, but if a point is transitioning between a peak and trough, it should have maximal displacement.\n\nThat is, I need to displace each point proportional to the rate of change of the sine curve, which is given by the cosine curve.\nSo the displacement function should be the same as `make_sine()`, but subbing in `cos()`.\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code  code-fold=\"true\"}\ntibble(\n  x = seq(0,1,length = 100),\n  sin = sin(x * 2 * pi),\n  cos = cos(x * 2 * pi)\n) |> \n  ggplot(\n    aes(x = x)\n  ) + \n  geom_hline(yintercept = 0) +\n  geom_textline(\n    aes(y = sin, color = \"sin\"),\n    label = \"sin\",\n    hjust = 0.4,\n    show.legend = F\n  ) + \n  geom_textline(\n    aes(y = cos, color = \"cos\"),\n    label = \"cos\",\n    hjust = 0.4,\n    show.legend = F\n  ) +\n  ob_segment(\n    ob_point(c(0,  0.5, 1),c(1, -1,  1)),\n    ob_point(c(0,  0.5 ,1), c(0,0,0)),\n    linewidth = 0.5,\n    linetype = 2\n  ) +\n  labs(y = NULL)\n\nlast_plot() + theme_darkmode()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-1.png){width=576}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-8-2.png){width=576}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_disp <- function(df){\n  # if there's no `freq` column\n  # set `freq` to 1.\n  if (!\"freq\" %in% names(df)) {\n    df$freq <- 1\n  }\n  \n  df |> \n    mutate(\n      disp = cos(\n        (freq * x * 2 * pi)\n      )\n    )\n}\n```\n:::\n\n\nI've colored the points according to their displacement just to show that we get high pressure areas where points displaced to the right and points displaced to the left meet.\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code}\nuniform |> \n  ggplot(\n    aes(x, y)\n  ) +\n  geom_point(\n    aes(\n      nudge_x = after_stat(disp * 0.1),\n      color = after_stat(disp)\n    ),\n    stat = \"manual\",\n    fun = make_disp,\n    position = \"nudge\"\n  ) + \n  geom_line(\n    data = tibble(\n      x = seq(0,2, length = 200)\n    ),\n    aes(\n      y = after_stat((y - 1) * 0.2)\n    ),\n    stat = \"manual\",\n    fun = make_sine\n  ) +\n  theme_no_y() + \n  theme_no_x()\n\nlast_plot() + theme_darkmode() + \n  theme_no_y() + \n  theme_no_x()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=576}\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-2.png){width=576}\n:::\n:::\n\n\nGreat!\nNow to make it move!\n\n## Animating it\n\nI'll need both a sine wave making function and a displacement making function that takes time into account, and shifts the phase accordingly.\nFinding [the right math for this](https://en.wikipedia.org/wiki/Phase_(waves)#For_shifted_signals) can be a little tricky, but implementing it is pretty straightforward.\nFor reasons I don't completely understand, in order to get the wave to propagate from left to right, I need to *subtract* the phase shift.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_moving_sine <- function(df){\n  params <- c(\"freq\", \"t\")\n  for (p in params){\n    if (!p %in% names(df)){\n      df[p] <- 1 \n    }\n  }\n  \n  df |> \n    mutate(\n      y = sin(\n        (freq * (x - t)* 2 * pi)\n      )\n    )\n}\n```\n:::\n\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code}\nexpand_grid(\n  x = seq(0, 2, length = 200),\n  t = seq(0, 3, length = 200),\n  freq = c(1, 2, 4)\n) |> \n  ggplot(\n    aes(\n      x, freq = freq, t = t\n    )\n  ) +\n  geom_line(\n    aes(\n      y = after_stat(y)\n    ),\n    stat = \"manual\",\n    fun = make_moving_sine\n  ) +\n  facet_wrap(~freq, ncol = 1) +\n  transition_time(t)+\n  theme_no_y() + \n  theme_no_x() ->\n  moving_sine\n  \nmoving_sine\nmoving_sine + theme_darkmode() +\n  theme_no_y() + \n  theme_no_x()  \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-1.gif)\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-12-2.gif)\n:::\n:::\n\n\nI really like this visualization because you can really see how the signals are moving at the same speed, but the one with a shorter wavelength has a faster frequency.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmake_moving_disp <- function(df){\n  params <- c(\"freq\", \"t\")\n  for (p in params){\n    if (!p %in% names(df)){\n      df[p] <- 1 \n    }\n  }\n  \n  df |> \n    mutate(\n      disp = cos(\n        (freq * (x - t)* 2 * pi)\n      )\n    )\n}\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntibble(\n  x = runif(500, max = 2),\n  y = runif(500),\n  row_id = 1:500\n) |>\n  reframe(\n    .by = row_id,\n    x = x,\n    y = y,\n    t = seq(0, 3, length = 200)\n  ) ->\n  air\n```\n:::\n\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code}\nair |>\n  ggplot(\n    aes(x, y, freq = 1, t = t)\n  ) +\n  geom_point(\n    aes(\n      nudge_x = after_stat(disp * 0.15)\n    ),\n    stat = \"manual\",\n    fun = make_moving_disp,\n    position = \"nudge\"\n  ) +\n  geom_line(\n    data = expand_grid(\n      x = seq(0,2, length = 200),\n      t = seq(0, 3, length = 200)\n    ),\n    aes(\n      y = after_stat((y - 1) * 0.2)\n    ),\n    stat = \"manual\",\n    fun = make_moving_sine\n  ) +  \n  transition_time(t) +\n  theme_no_x() +\n  theme_no_y() ->\n  air_wave\n\nair_wave\nair_wave + theme_darkmode() +\n  theme_no_x() +\n  theme_no_y()   \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-1.gif)\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-15-2.gif)\n:::\n:::\n\n\n## Bonus\n\nHere's a bonus gif, just cause I found it really pretty when I mapped the point color to the displacement.\n\n\n::: {.cell renderings='[\"light\",\"dark\"]'}\n\n```{.r .cell-code}\nair |>\n  ggplot(\n    aes(x, y, freq = 1, t = t)\n  ) +\n  geom_point(\n    aes(\n      nudge_x = after_stat(disp * 0.1),\n      color = after_stat(disp)\n    ),\n    stat = \"manual\",\n    fun = make_moving_disp,\n    position = \"nudge\"\n  ) +  \n  transition_time(t) +\n  theme_no_x() +\n  theme_no_y() ->\n  glimmer\n\nglimmer\nglimmer + theme_darkmode() +\n  theme_no_x() +\n  theme_no_y()   \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-1.gif)\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-16-2.gif)\n:::\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}